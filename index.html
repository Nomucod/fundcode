<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸‹å–®ä»£è™ŸæŸ¥è©¢</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary-blue: #1a5f7a;
            --accent-blue: #eef5f9;
            --text-main: #2c3e50;
            --border-color: #dbe4eb;
            --danger-red: #d63031;
        }
        body { 
            background-color: #f0f4f7; 
            color: var(--text-main); 
            font-size: 14px; 
            padding-bottom: 40px; 
            font-family: "Microsoft JhengHei", "PingFang TC", sans-serif; 
        }
        .container { max-width: 850px; width: 95%; margin: auto; }
        
        /* --- ç¶²é ç«¯éŸ¿æ‡‰å¼é è¦½æ¨£å¼ --- */
        .fund-name { font-size: 1rem; font-weight: bold; line-height: 1.4; }
        .fund-sub-info { font-size: 0.85rem; color: #6c757d; margin-top: 3px; }
        .code-highlight { font-weight: bold; color: var(--danger-red); font-family: 'Consolas', monospace; font-size: 1.15rem; line-height: 1.2; }
        h6.title-label { font-size: 1.1rem; font-weight: bold; }

        @media (max-width: 576px) {
            .fund-name { font-size: 0.95rem; }
            .code-highlight { font-size: 1rem; }
        }

        /* -------------------------------------------------- */
        /* ğŸ“¸ æˆªåœ–è¼¸å‡ºå°ˆç”¨å·¨å¤§åŒ–æ¨£å¼ (èˆ‡ç¶²é é è¦½å¾¹åº•åˆ†é›¢) */
        /* -------------------------------------------------- */
        .screenshot-mode h6.title-label { font-size: 34px !important; font-weight: bold !important; padding: 18px !important; }
        .screenshot-mode .fund-name { font-size: 34px !important; font-weight: bold !important; line-height: 1.3 !important; }
        .screenshot-mode .fund-sub-info { font-size: 2rem !important; font-weight: bold !important; line-height: 1.4 !important; color: #444 !important; }
        .screenshot-mode .code-highlight { font-size: 2.4rem !important; font-weight: bold !important; line-height: 1.2 !important; }
        .screenshot-mode .screenshot-footer { font-size: 1.2rem !important; font-weight: bold !important; padding-top: 15px !important; color: #333 !important; }
        .screenshot-mode .code-col { width: 330px !important; } /* å¯¬åº¦é…åˆå¤§å­—é«” */
        .screenshot-mode table th { font-size: 22px !important; font-weight: bold !important; }

        /* è¡¨æ ¼æ’ç‰ˆ */
        .table-custom { width: 100%; border-collapse: collapse; background: white; table-layout: auto; }
        .table-custom thead th { background: var(--primary-blue); color: white; padding: 10px 8px; white-space: nowrap; }
        .table-custom tbody td { padding: 12px 8px; border-bottom: 1px solid #eee; vertical-align: middle; }
        .code-col { text-align: center; width: 150px; }
        
        .nav-tabs .nav-link { border: none; color: #7f8c8d; font-weight: bold; padding: 12px; cursor: pointer; }
        .nav-tabs .nav-link.active { background: var(--primary-blue) !important; color: white !important; border-radius: 8px 8px 0 0; }
        .tab-content { background: white; padding: 15px; border-radius: 0 0 12px 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .section-header { background: var(--accent-blue); color: var(--primary-blue); font-weight: bold; padding: 10px 15px; border-radius: 8px; margin-bottom: 15px; border-left: 5px solid var(--primary-blue); display: flex; justify-content: space-between; align-items: center; }
        .list-container { max-height: 200px; overflow-y: auto; border: 1px solid var(--border-color); padding: 10px; border-radius: 8px; background: #fff; margin-bottom: 15px; }
        .btn-shot { background: var(--primary-blue); color: white; border: none; padding: 12px; border-radius: 8px; font-weight: bold; width: 100%; margin-top: 15px; }
        #pinSettingsArea { display: none; background: #fff; border: 2px solid var(--primary-blue); border-radius: 12px; padding: 15px; margin-bottom: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .screenshot-footer { font-size: 0.75rem; color: #666; border-top: 1px solid #eee; padding-top: 8px; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container py-3">
    <h5 class="text-center fw-bold mb-3" style="color: var(--primary-blue);">ä¸‹å–®ä»£è™ŸæŸ¥è©¢</h5>

    <div id="pinSettingsArea">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <h6 class="fw-bold mb-0">ğŸ“Œ å¸¸ç”¨æ©Ÿæ§‹é‡˜é¸è¨­å®š</h6>
            <button class="btn btn-sm btn-primary" onclick="savePins()">å®Œæˆä¸¦å„²å­˜</button>
        </div>
        <div id="pinCheckboxes" class="list-container" style="max-height: 250px;"></div>
    </div>

    <ul class="nav nav-tabs nav-fill" id="queryTab" role="tablist">
        <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#on-pane" type="button">å¢ƒå…§åŸºé‡‘</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#gsam-pane" type="button">GSAM</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#sicav-pane" type="button">GSAM(SICAV)</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#ninetyone-pane" type="button">æ™‰é”</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#ireland-pane" type="button">æ„›çˆ¾è˜­</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#janus-pane" type="button">é§¿åˆ©</button></li>
    </ul>

    <div class="tab-content" id="queryTabContent">
        <div class="tab-pane fade show active" id="on-pane" role="tabpanel">
            <div class="section-header"><span>å¢ƒå…§åŸºé‡‘æŸ¥è©¢ç³»çµ±</span><button class="btn btn-sm btn-outline-primary" onclick="togglePinSettings()">âš™ï¸ é‡˜é¸</button></div>
            <select id="bankOn" class="form-select mb-3"><option value="">-- é¸æ“‡éŠ·å”®æ©Ÿæ§‹ --</option></select>
            <div class="row g-1 mb-3">
                <div class="col-3"><div class="form-check"><input class="form-check-input on-filter" type="checkbox" id="onTISA"><label class="form-check-label">TISA</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input on-filter" type="checkbox" id="onPre"><label class="form-check-label">å‰æ”¶</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input on-filter" type="checkbox" id="onPost"><label class="form-check-label">å¾Œæ”¶</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input on-filter" type="checkbox" id="onAcc"><label class="form-check-label">ç´¯ç©</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input on-filter" type="checkbox" id="onDiv"><label class="form-check-label">é…æ¯</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input on-filter" type="checkbox" id="onRMB"><label class="form-check-label">äººæ°‘å¹£</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input on-filter" type="checkbox" id="onAUD"><label class="form-check-label">æ¾³å¹£</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input on-filter" type="checkbox" id="onZAR"><label class="form-check-label">å—éå¹£</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input on-filter" type="checkbox" id="onJPY"><label class="form-check-label">æ—¥å¹£</label></div></div>
            </div>
            <div id="listOn" class="list-container">è³‡æ–™åŠ è¼‰ä¸­...</div>
            <div id="areaOn" style="display:none;">
                <div id="captureOn" style="background: white; padding: 15px;">
                    <h6 class="text-center fw-bold mb-2 p-2 rounded title-label" id="titleOn" style="color: var(--primary-blue); background: var(--accent-blue);"></h6>
                    <table class="table-custom"><thead><tr><th>åŸºé‡‘æ˜ç´°</th><th class="code-col">ä»£è™Ÿ</th></tr></thead><tbody id="bodyOn"></tbody></table>
                    <div class="screenshot-footer">ä¸‹å–®ä»£è™Ÿæœ‰â—å³è¡¨ç¤ºç‚ºã€Œç›®å‰ä¸æ¥å—æ–°ç”³è³¼ã€ï¼ŒVå³è¡¨ç¤ºç‚ºã€Œå·²ä¸Šæ¶ã€åŸºé‡‘ä½†ç„¡ä»£è™Ÿ</div>
                </div>
                <button class="btn btn-shot" onclick="handleScreenshot('captureOn', 'å¢ƒå…§åŸºé‡‘', 10)">ğŸ“¸ æ‹ç…§æˆªåœ– (10ç­†/é )</button>
            </div>
        </div>

        <div class="tab-pane fade" id="gsam-pane" role="tabpanel">
            <div class="section-header"><span>GSAMæŸ¥è©¢ç³»çµ±</span><button class="btn btn-sm btn-outline-primary" onclick="togglePinSettings()">âš™ï¸ é‡˜é¸</button></div>
            <select id="bankGsam" class="form-select mb-3"><option value="">-- é¸æ“‡éŠ·å”®æ©Ÿæ§‹ --</option></select>
            <div class="row g-1 mb-3">
                <div class="col-3"><div class="form-check"><input class="form-check-input gsam-filter" type="checkbox" id="gsamPre"><label class="form-check-label">å‰æ”¶</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input gsam-filter" type="checkbox" id="gsamPost"><label class="form-check-label">å¾Œæ”¶</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input gsam-filter" type="checkbox" id="gsamAcc"><label class="form-check-label">ç´¯ç©</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input gsam-filter" type="checkbox" id="gsamDiv"><label class="form-check-label">é…æ¯</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input gsam-filter" type="checkbox" id="gsamJPY"><label class="form-check-label">æ—¥åœ“</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input gsam-filter" type="checkbox" id="gsamUSD"><label class="form-check-label">ç¾å…ƒ</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input gsam-filter" type="checkbox" id="gsamEUR"><label class="form-check-label">æ­å…ƒ</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input gsam-filter" type="checkbox" id="gsamEURH"><label class="form-check-label">å°æ²–æ­å…ƒ</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input gsam-filter" type="checkbox" id="gsamUSDH"><label class="form-check-label">å°æ²–ç¾å…ƒ</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input gsam-filter" type="checkbox" id="gsamAUDH"><label class="form-check-label">å°æ²–æ¾³å¹£</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input gsam-filter" type="checkbox" id="gsamZARH"><label class="form-check-label">å°æ²–å—éå¹£</label></div></div>
            </div>
            <div id="listGsam" class="list-container">è¼‰å…¥ä¸­...</div>
            <div id="areaGsam" style="display:none;">
                <div id="captureGsam" style="background: white; padding: 15px;">
                    <h6 class="text-center fw-bold mb-2 p-2 rounded title-label" id="titleGsam" style="color: var(--primary-blue); background: var(--accent-blue);"></h6>
                    <table class="table-custom"><thead><tr><th>åŸºé‡‘æ˜ç´°</th><th class="code-col">ä»£è™Ÿ</th></tr></thead><tbody id="bodyGsam"></tbody></table>
                    <div class="screenshot-footer">ä¸‹å–®ä»£è™Ÿæœ‰â—å³è¡¨ç¤ºç‚ºã€Œç›®å‰ä¸æ¥å—æ–°ç”³è³¼ã€ï¼ŒVå³è¡¨ç¤ºç‚ºã€Œå·²ä¸Šæ¶ã€åŸºé‡‘ä½†ç„¡ä»£è™Ÿ</div>
                </div>
                <button class="btn btn-shot" onclick="handleScreenshot('captureGsam', 'GSAMæŸ¥è©¢', 10)">ğŸ“¸ æ‹ç…§æˆªåœ– (10ç­†/é )</button>
            </div>
        </div>

        <div class="tab-pane fade" id="sicav-pane" role="tabpanel">
            <div class="section-header"><span>GSAM(SICAV)æŸ¥è©¢ç³»çµ±</span><button class="btn btn-sm btn-outline-primary" onclick="togglePinSettings()">âš™ï¸ é‡˜é¸</button></div>
            <select id="bankSicav" class="form-select mb-3"><option value="">-- é¸æ“‡éŠ·å”®æ©Ÿæ§‹ --</option></select>
            <div class="row g-1 mb-3">
                <div class="col-3"><div class="form-check"><input class="form-check-input sicav-filter" type="checkbox" id="sicavPre"><label class="form-check-label">å‰æ”¶</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input sicav-filter" type="checkbox" id="sicavPost"><label class="form-check-label">å¾Œæ”¶</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input sicav-filter" type="checkbox" id="sicavAcc"><label class="form-check-label">ç´¯ç©</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input sicav-filter" type="checkbox" id="sicavDiv"><label class="form-check-label">é…æ¯</label></div></div>
                <div class="col-4"><div class="form-check"><input class="form-check-input sicav-filter" type="checkbox" id="sicavUSDH"><label class="form-check-label">ç¾å…ƒé¿éšª</label></div></div>
                <div class="col-4"><div class="form-check"><input class="form-check-input sicav-filter" type="checkbox" id="sicavJPYH"><label class="form-check-label">æ—¥åœ“é¿éšª</label></div></div>
                <div class="col-4"><div class="form-check"><input class="form-check-input sicav-filter" type="checkbox" id="sicavAUDH"><label class="form-check-label">æ¾³å¹£é¿éšª</label></div></div>
            </div>
            <div id="listSicav" class="list-container">è¼‰å…¥ä¸­...</div>
            <div id="areaSicav" style="display:none;">
                <div id="captureSicav" style="background: white; padding: 15px;">
                    <h6 class="text-center fw-bold mb-2 p-2 rounded title-label" id="titleSicav" style="color: var(--primary-blue); background: var(--accent-blue);"></h6>
                    <table class="table-custom"><thead><tr><th>åŸºé‡‘æ˜ç´°</th><th class="code-col">ä»£è™Ÿ</th></tr></thead><tbody id="bodySicav"></tbody></table>
                    <div class="screenshot-footer">ä¸‹å–®ä»£è™Ÿæœ‰â—å³è¡¨ç¤ºç‚ºã€Œç›®å‰ä¸æ¥å—æ–°ç”³è³¼ã€ï¼ŒVå³è¡¨ç¤ºç‚ºã€Œå·²ä¸Šæ¶ã€åŸºé‡‘ä½†ç„¡ä»£è™Ÿ</div>
                </div>
                <button class="btn btn-shot" onclick="handleScreenshot('captureSicav', 'SICAVæŸ¥è©¢', 10)">ğŸ“¸ æ‹ç…§æˆªåœ– (10ç­†/é )</button>
            </div>
        </div>

        <div class="tab-pane fade" id="ninetyone-pane" role="tabpanel">
            <div class="section-header"><span>æ™‰é”ä¸‹å–®æŸ¥è©¢ç³»çµ±</span><button class="btn btn-sm btn-outline-primary" onclick="togglePinSettings()">âš™ï¸ é‡˜é¸</button></div>
            <select id="bankNinetyone" class="form-select mb-3"><option value="">-- é¸æ“‡éŠ·å”®æ©Ÿæ§‹ --</option></select>
            <div class="row g-1 mb-3">
                <div class="col-3"><div class="form-check"><input class="form-check-input ninetyone-filter" type="checkbox" id="ninetyonePre"><label class="form-check-label">å‰æ”¶</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input ninetyone-filter" type="checkbox" id="ninetyoneAcc"><label class="form-check-label">ç´¯ç©</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input ninetyone-filter" type="checkbox" id="ninetyoneDiv"><label class="form-check-label">é…æ¯</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input ninetyone-filter" type="checkbox" id="ninetyoneUSD"><label class="form-check-label">ç¾å…ƒ</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input ninetyone-filter" type="checkbox" id="ninetyoneGBP"><label class="form-check-label">è‹±éŠ</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input ninetyone-filter" type="checkbox" id="ninetyoneEUR"><label class="form-check-label">æ­å…ƒ</label></div></div>
                <div class="col-4"><div class="form-check"><input class="form-check-input ninetyone-filter" type="checkbox" id="ninetyoneUSDH"><label class="form-check-label">ç¾å…ƒé¿éšª</label></div></div>
                <div class="col-4"><div class="form-check"><input class="form-check-input ninetyone-filter" type="checkbox" id="ninetyoneAUDH"><label class="form-check-label">æ¾³å¹£é¿éšªIRD</label></div></div>
                <div class="col-4"><div class="form-check"><input class="form-check-input ninetyone-filter" type="checkbox" id="ninetyoneZARH"><label class="form-check-label">å—éå¹£é¿éšªIRD</label></div></div>
            </div>
            <div id="listNinetyone" class="list-container">è¼‰å…¥ä¸­...</div>
            <div id="areaNinetyone" style="display:none;">
                <div id="captureNinetyone" style="background: white; padding: 15px;">
                    <h6 class="text-center fw-bold mb-2 p-2 rounded title-label" id="titleNinetyone" style="color: var(--primary-blue); background: var(--accent-blue);"></h6>
                    <table class="table-custom"><thead><tr><th>åŸºé‡‘æ˜ç´°</th><th class="code-col">ä»£è™Ÿ</th></tr></thead><tbody id="bodyNinetyone"></tbody></table>
                    <div class="screenshot-footer">ä¸‹å–®ä»£è™Ÿæœ‰â—å³è¡¨ç¤ºç‚ºã€Œç›®å‰ä¸æ¥å—æ–°ç”³è³¼ã€ï¼ŒVå³è¡¨ç¤ºç‚ºã€Œå·²ä¸Šæ¶ã€åŸºé‡‘ä½†ç„¡ä»£è™Ÿ</div>
                </div>
                <button class="btn btn-shot" onclick="handleScreenshot('captureNinetyone', 'æ™‰é”æŸ¥è©¢', 10)">ğŸ“¸ æ‹ç…§æˆªåœ– (10ç­†/é )</button>
            </div>
        </div>

        <div class="tab-pane fade" id="ireland-pane" role="tabpanel">
            <div class="section-header"><span>æ„›çˆ¾è˜­ä¸‹å–®æŸ¥è©¢ç³»çµ±</span><button class="btn btn-sm btn-outline-primary" onclick="togglePinSettings()">âš™ï¸ é‡˜é¸</button></div>
            <select id="bankIreland" class="form-select mb-3"><option value="">-- é¸æ“‡éŠ·å”®æ©Ÿæ§‹ --</option></select>
            <div class="row g-1 mb-3">
                <div class="col-3"><div class="form-check"><input class="form-check-input ireland-filter" type="checkbox" id="irelandPre"><label class="form-check-label">å‰æ”¶</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input ireland-filter" type="checkbox" id="irelandPost"><label class="form-check-label">å¾Œæ”¶</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input ireland-filter" type="checkbox" id="irelandAcc"><label class="form-check-label">ç´¯ç©</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input ireland-filter" type="checkbox" id="irelandDiv"><label class="form-check-label">é…æ¯</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input ireland-filter" type="checkbox" id="irelandJPY"><label class="form-check-label">æ—¥åœ“</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input ireland-filter" type="checkbox" id="irelandJPYH"><label class="form-check-label">æ—¥åœ“é¿éšª</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input ireland-filter" type="checkbox" id="irelandZARH"><label class="form-check-label">å—éå¹£é¿éšª</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input ireland-filter" type="checkbox" id="irelandUSD"><label class="form-check-label">ç¾å…ƒ</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input ireland-filter" type="checkbox" id="irelandUSDH"><label class="form-check-label">ç¾å…ƒé¿éšª</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input ireland-filter" type="checkbox" id="irelandAUD"><label class="form-check-label">æ¾³å¹£</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input ireland-filter" type="checkbox" id="irelandAUDH"><label class="form-check-label">æ¾³å¹£é¿éšª</label></div></div>
            </div>
            <div id="listIreland" class="list-container">è¼‰å…¥ä¸­...</div>
            <div id="areaIreland" style="display:none;">
                <div id="captureIreland" style="background: white; padding: 15px;">
                    <h6 class="text-center fw-bold mb-2 p-2 rounded title-label" id="titleIreland" style="color: var(--primary-blue); background: var(--accent-blue);"></h6>
                    <table class="table-custom"><thead><tr><th>åŸºé‡‘æ˜ç´°</th><th class="code-col">ä»£è™Ÿ</th></tr></thead><tbody id="bodyIreland"></tbody></table>
                    <div class="screenshot-footer">ä¸‹å–®ä»£è™Ÿæœ‰â—å³è¡¨ç¤ºç‚ºã€Œç›®å‰ä¸æ¥å—æ–°ç”³è³¼ã€ï¼ŒVå³è¡¨ç¤ºç‚ºã€Œå·²ä¸Šæ¶ã€åŸºé‡‘ä½†ç„¡ä»£è™Ÿ</div>
                </div>
                <button class="btn btn-shot" onclick="handleScreenshot('captureIreland', 'æ„›çˆ¾è˜­æŸ¥è©¢', 10)">ğŸ“¸ æ‹ç…§æˆªåœ– (10ç­†/é )</button>
            </div>
        </div>

        <div class="tab-pane fade" id="janus-pane" role="tabpanel">
            <div class="section-header"><span>é§¿åˆ©ä¸‹å–®æŸ¥è©¢ç³»çµ±</span><button class="btn btn-sm btn-outline-primary" onclick="togglePinSettings()">âš™ï¸ é‡˜é¸</button></div>
            <select id="bankJanus" class="form-select mb-3"><option value="">-- é¸æ“‡éŠ·å”®æ©Ÿæ§‹ --</option></select>
            <div class="row g-1 mb-3">
                <div class="col-3"><div class="form-check"><input class="form-check-input janus-filter" type="checkbox" id="janusPre"><label class="form-check-label">å‰æ”¶</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input janus-filter" type="checkbox" id="janusPost"><label class="form-check-label">å¾Œæ”¶</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input janus-filter" type="checkbox" id="janusAcc"><label class="form-check-label">ç´¯ç©</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input janus-filter" type="checkbox" id="janusDiv"><label class="form-check-label">é…æ¯</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input janus-filter" type="checkbox" id="janusJPY"><label class="form-check-label">æ—¥åœ“</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input janus-filter" type="checkbox" id="janusUSD"><label class="form-check-label">ç¾å…ƒ</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input janus-filter" type="checkbox" id="janusUSDH"><label class="form-check-label">ç¾å…ƒé¿éšª</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input janus-filter" type="checkbox" id="janusAUDH"><label class="form-check-label">æ¾³å¹£é¿éšª</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input janus-filter" type="checkbox" id="janusEUR"><label class="form-check-label">æ­å…ƒ</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input janus-filter" type="checkbox" id="janusEURH"><label class="form-check-label">æ­å…ƒé¿éšª</label></div></div>
                <div class="col-3"><div class="form-check"><input class="form-check-input janus-filter" type="checkbox" id="janusCADH"><label class="form-check-label">åŠ å¹£é¿éšª</label></div></div>
            </div>
            <div id="listJanus" class="list-container">è¼‰å…¥ä¸­...</div>
            <div id="areaJanus" style="display:none;">
                <div id="captureJanus" style="background: white; padding: 15px;">
                    <h6 class="text-center fw-bold mb-2 p-2 rounded title-label" id="titleJanus" style="color: var(--primary-blue); background: var(--accent-blue);"></h6>
                    <table class="table-custom"><thead><tr><th>åŸºé‡‘æ˜ç´°</th><th class="code-col">ä»£è™Ÿ</th></tr></thead><tbody id="bodyJanus"></tbody></table>
                    <div class="screenshot-footer">ä¸‹å–®ä»£è™Ÿæœ‰â—å³è¡¨ç¤ºç‚ºã€Œç›®å‰ä¸æ¥å—æ–°ç”³è³¼ã€ï¼ŒVå³è¡¨ç¤ºç‚ºã€Œå·²ä¸Šæ¶ã€åŸºé‡‘ä½†ç„¡ä»£è™Ÿ</div>
                </div>
                <button class="btn btn-shot" onclick="handleScreenshot('captureJanus', 'é§¿åˆ©æŸ¥è©¢', 10)">ğŸ“¸ æ‹ç…§æˆªåœ– (10ç­†/é )</button>
            </div>
        </div>
    </div>
</div>

<script>
    let datasets = { On: [], Gsam: [], Sicav: [], Ninetyone: [], Ireland: [], Janus: [] };
    let allBanks = [];

    // --- æ™ºæ…§æ ¼å¼åŒ–ï¼šå¤šçµ„é•·ä»£è™Ÿè‡ªå‹•æ–·è¡Œ ---
    function formatOrderCode(code) {
        if (!code) return "";
        let parts = String(code).split(/\s+/).filter(p => p.trim().length > 0);
        if (parts.length > 1 && parts.some(p => p.length > 6)) {
            return parts.join("<br>");
        }
        return code;
    }

    function getSmartInfo(row) {
        return {
            name: row['åŸºé‡‘åç¨±'] || row['ä¸»è¦åŸºé‡‘'] || "æœªçŸ¥åŸºé‡‘",
            type: row['é¡å‹'] || row['ç´šåˆ¥'] || row['é…æ¯'] || "",
            curr: row['å¹£åˆ¥'] || ""
        };
    }

    function loadCSV(filename, suffix, callback) {
        Papa.parse(filename, {
            download: true, header: true, skipEmptyLines: true,
            transformHeader: h => h.trim().replace(/\uFEFF/g, ''),
            complete: res => {
                if (res.data && res.data.length > 0) {
                    datasets[suffix] = res.data;
                    const meta = ['åŸºé‡‘åç¨±', 'ä¸»è¦åŸºé‡‘', 'é¡å‹', 'ç´šåˆ¥', 'å¹£åˆ¥', 'é…æ¯'];
                    const banks = res.meta.fields.filter(f => f && !meta.includes(f));
                    allBanks = [...new Set([...allBanks, ...banks])];
                    refreshDropdowns();
                    if(callback) callback();
                }
            }
        });
    }

    window.onload = function() {
        loadCSV("on.csv", "On", () => initPage('On'));
        loadCSV("off1.csv", "Gsam", () => initPage('Gsam'));
        loadCSV("off2.csv", "Sicav", () => initPage('Sicav'));
        loadCSV("off3.csv", "Ninetyone", () => initPage('Ninetyone'));
        loadCSV("off4.csv", "Ireland", () => initPage('Ireland'));
        loadCSV("off5.csv", "Janus", () => initPage('Janus'));
    };

    function refreshDropdowns() {
        const pinned = JSON.parse(localStorage.getItem('pinnedBanks') || "[]");
        ['bankOn', 'bankGsam', 'bankSicav', 'bankNinetyone', 'bankIreland', 'bankJanus'].forEach(id => {
            const el = document.getElementById(id);
            if (!el) return;
            const cur = el.value;
            el.innerHTML = '<option value="">-- é¸æ“‡éŠ·å”®æ©Ÿæ§‹ --</option>';
            const p = allBanks.filter(b => pinned.includes(b)).sort();
            const o = allBanks.filter(b => !pinned.includes(b)).sort();
            if(p.length > 0) {
                p.forEach(b => el.add(new Option("ğŸ“Œ " + b, b)));
                el.add(new Option("--------------------", ""));
            }
            o.forEach(b => el.add(new Option(b, b)));
            el.value = cur;
        });
    }

    function applyFilters(suffix, row, bank, f) {
        const code = String(row[bank] || "").trim();
        if (code === '' || code === 'X' || code === 'â—') return false;
        const { type, curr, name } = getSmartInfo(row);

        if (suffix === 'On' && f.tisa && !name.includes("TISA")) return false;

        // è²»ç”¨ (ä¸¦å­˜è¯é›†)
        let feeMatch = true;
        if (f.pre || f.post) {
            feeMatch = false;
            if (f.pre && type.includes("å‰æ”¶")) feeMatch = true;
            if (f.post && type.includes("å¾Œæ”¶")) feeMatch = true;
        }

        // é…æ¯/ç´¯ç© (ç²¾ç¢ºäº¤é›†é‚è¼¯)
        let payoutMatch = true;
        if (f.acc || f.div) {
            payoutMatch = false;
            if (suffix === 'Janus') {
                if (f.pre) {
                    if (f.acc && type === "å‰æ”¶ç´¯ç©") payoutMatch = true;
                    if (f.div && ["å‰æ”¶æœˆé…", "å‰æ”¶å­£é…", "å‰æ”¶ç©©æœˆé…"].includes(type)) payoutMatch = true;
                } else if (f.post) {
                    if (f.acc && type === "å¾Œæ”¶ç´¯ç©") payoutMatch = true;
                    if (f.div && type === "å¾Œæ”¶ç©©æœˆé…") payoutMatch = true;
                } else {
                    if (f.acc && type.includes("ç´¯ç©")) payoutMatch = true;
                    if (f.div && (type.includes("é…æ¯") || type.includes("æœˆé…"))) payoutMatch = true;
                }
            } else if (suffix === 'Ireland' || suffix === 'Ninetyone') {
                if (f.pre) {
                    if (f.acc && type.includes("å‰æ”¶ç´¯ç©")) payoutMatch = true;
                    if (f.div && type.includes("å‰æ”¶é…æ¯")) payoutMatch = true;
                } else if (f.post) {
                    if (f.acc && type.includes("å¾Œæ”¶ç´¯ç©")) payoutMatch = true;
                    if (f.div && type.includes("å¾Œæ”¶æœˆé…")) payoutMatch = true;
                } else {
                    if (f.acc && type.includes("ç´¯ç©")) payoutMatch = true;
                    if (f.div && (type.includes("é…æ¯") || type.includes("æœˆé…"))) payoutMatch = true;
                }
            } else if (suffix === 'Sicav' && f.pre) {
                if (f.acc && type === "å‰æ”¶ç´¯ç©") payoutMatch = true;
                if (f.div && ["å‰æ”¶å¹´é…", "å‰æ”¶ç©©å®šè³‡æœ¬æœˆé…æ¯"].includes(type)) payoutMatch = true;
            } else {
                if (f.acc && type.includes("ç´¯ç©")) payoutMatch = true;
                if (f.div && (type.includes("é…æ¯") || type.includes("æœˆé…") || type.includes("å­£é…") || type.includes("å¹´é…"))) payoutMatch = true;
            }
        }

        // å¹£åˆ¥ (ä¸¦å­˜è¯é›†)
        let currMatch = true;
        const activeCurrs = Object.keys(f).filter(k => f[k] && !['tisa', 'pre', 'post', 'acc', 'div'].includes(k));
        if (activeCurrs.length > 0) {
            currMatch = false;
            if (suffix === 'Janus') {
                if (f.jpy && curr === "æ—¥åœ“") currMatch = true;
                if (f.usd && curr === "ç¾å…ƒ") currMatch = true;
                if (f.usdh && curr.includes("ç¾å…ƒé¿éšª")) currMatch = true;
                if (f.audh && curr.includes("æ¾³å¹£é¿éšª")) currMatch = true;
                if (f.eur && curr === "æ­å…ƒ") currMatch = true;
                if (f.eurh && curr.includes("æ­å…ƒé¿éšª")) currMatch = true;
                if (f.cadh && curr.includes("åŠ å¹£é¿éšª")) currMatch = true;
            } else if (suffix === 'On') {
                if (f.rmb && curr.includes("äººæ°‘å¹£")) currMatch = true;
                if (f.aud && curr.includes("æ¾³å¹£")) currMatch = true;
                if (f.zar && curr.includes("å—éå¹£")) currMatch = true;
                if (f.jpy && curr.includes("æ—¥å¹£")) currMatch = true;
            } else if (suffix === 'Gsam') {
                if (f.jpy && curr.includes("æ—¥åœ“")) currMatch = true;
                if (f.usd && curr === "ç¾å…ƒ") currMatch = true;
                if (f.eur && curr === "æ­å…ƒ") currMatch = true;
                if (f.eurh && curr.includes("å°æ²–æ­å…ƒ")) currMatch = true;
                if (f.usdh && curr.includes("å°æ²–ç¾å…ƒ")) currMatch = true;
                if (f.audh && curr.includes("å°æ²–æ¾³å¹£")) currMatch = true;
                if (f.zarh && curr.includes("å°æ²–å—éå¹£")) currMatch = true;
            } else if (suffix === 'Sicav') {
                if (f.usdh && curr.includes("ç¾å…ƒé¿éšª")) currMatch = true;
                if (f.jpyh && curr.includes("æ—¥åœ“é¿éšª")) currMatch = true;
                if (f.audh && curr.includes("æ¾³å¹£é¿éšª")) currMatch = true;
            } else if (suffix === 'Ireland') {
                if (f.jpy && curr === "æ—¥åœ“") currMatch = true;
                if (f.jpyh && curr.includes("æ—¥åœ“é¿éšª")) currMatch = true;
                if (f.zarh && curr.includes("å—éå¹£é¿éšª")) currMatch = true;
                if (f.usd && curr === "ç¾å…ƒ") currMatch = true;
                if (f.usdh && curr.includes("ç¾å…ƒé¿éšª")) currMatch = true;
                if (f.aud && curr === "æ¾³å¹£") currMatch = true;
                if (f.audh && curr.includes("æ¾³å¹£é¿éšª")) currMatch = true;
            } else if (suffix === 'Ninetyone') {
                if (f.usd && curr === "ç¾å…ƒ") currMatch = true;
                if (f.gbp && curr === "è‹±éŠ") currMatch = true;
                if (f.eur && curr === "æ­å…ƒ") currMatch = true;
                if (f.usdh && curr.includes("ç¾å…ƒé¿éšª")) currMatch = true;
                if (f.audh && curr.includes("æ¾³å¹£é¿éšª")) currMatch = true;
                if (f.zarh && curr.includes("å—éå¹£é¿éšª")) currMatch = true;
            }
        }
        return feeMatch && payoutMatch && currMatch;
    }

    function initPage(suffix) {
        const bankEl = document.getElementById(`bank${suffix}`);
        const filters = document.querySelectorAll(`.${suffix.toLowerCase()}-filter`);
        const update = () => {
            const bank = bankEl.value; if (!bank) return;
            const f = {}; filters.forEach(el => f[el.id.replace(suffix.toLowerCase(),'').toLowerCase()] = el.checked);
            const filtered = datasets[suffix].filter(row => applyFilters(suffix, row, bank, f));
            const listDiv = document.getElementById(`list${suffix}`);
            const names = [...new Set(filtered.map(r => getSmartInfo(r).name))].sort();
            listDiv.innerHTML = `<div class="form-check"><input class="form-check-input" type="checkbox" id="${suffix.toLowerCase()}_all" checked><label class="form-check-label fw-bold">å…¨éƒ¨é¡¯ç¤º (${names.length})</label></div>`;
            names.forEach((n, idx) => { listDiv.innerHTML += `<div class="form-check"><input class="form-check-input chk-${suffix.toLowerCase()}" type="checkbox" value="${n}" id="${suffix.toLowerCase()}_${idx}"><label class="form-check-label" for="${suffix.toLowerCase()}_${idx}">${n}</label></div>`; });
            const allBtn = document.getElementById(`${suffix.toLowerCase()}_all`), items = document.querySelectorAll(`.chk-${suffix.toLowerCase()}`);
            const refreshTable = () => {
                const checked = Array.from(document.querySelectorAll(`.chk-${suffix.toLowerCase()}:checked`)).map(c => c.value);
                let final = (allBtn.checked || checked.length === 0) ? filtered : filtered.filter(r => checked.includes(getSmartInfo(r).name));
                document.getElementById(`area${suffix}`).style.display = final.length ? 'block' : 'none';
                document.getElementById(`title${suffix}`).innerText = bank + " éŠ·å”®ä»£ç¢¼";
                const body = document.getElementById(`body${suffix}`); body.innerHTML = '';
                final.forEach(r => {
                    const info = getSmartInfo(r);
                    body.innerHTML += `<tr><td><div class="fund-name">${info.name}</div><div class="fund-sub-info">${info.curr} | ${info.type}</div></td><td class="code-col code-highlight">${formatOrderCode(r[bank])}</td></tr>`;
                });
            };
            allBtn.onclick = () => { if(allBtn.checked) items.forEach(i => i.checked = false); refreshTable(); };
            items.forEach(i => i.onclick = () => { if(i.checked) allBtn.checked = false; refreshTable(); });
            refreshTable();
        };
        bankEl.onchange = update;
        filters.forEach(el => el.onchange = update);
    }

    async function handleScreenshot(elId, name, pageSize) {
        const el = document.getElementById(elId);
        const rows = Array.from(el.querySelectorAll('tbody tr'));
        el.classList.add('screenshot-mode');
        const ow = el.style.width; el.style.width = "950px"; 
        if (rows.length <= pageSize) {
            const canvas = await html2canvas(el, { scale: 2, backgroundColor: "#ffffff" });
            save(canvas.toDataURL(), `${name}.png`);
        } else {
            alert(`å…± ${rows.length} ç­†ï¼Œå°‡åˆ† ${Math.ceil(rows.length/pageSize)} é æˆªåœ–ã€‚`);
            for (let i = 0; i < rows.length; i += pageSize) {
                rows.forEach((r, idx) => r.style.display = (idx >= i && idx < i + pageSize) ? '' : 'none');
                const canvas = await html2canvas(el, { scale: 2, backgroundColor: "#ffffff" });
                save(canvas.toDataURL(), `${name}_P${Math.floor(i/pageSize)+1}.png`);
            }
            rows.forEach(r => r.style.display = '');
        }
        el.style.width = ow; el.classList.remove('screenshot-mode');
    }

    function save(u, n) { const a = document.createElement('a'); a.download = n; a.href = u; a.click(); }
    function togglePinSettings() {
        const area = document.getElementById('pinSettingsArea');
        area.style.display = (area.style.display === 'block') ? 'none' : 'block';
        if(area.style.display === 'block') {
            const container = document.getElementById('pinCheckboxes');
            const pinned = JSON.parse(localStorage.getItem('pinnedBanks') || "[]");
            container.innerHTML = "";
            allBanks.sort().forEach(b => {
                container.innerHTML += `<div class="form-check"><input class="form-check-input chk-pin" type="checkbox" value="${b}" id="pin_${b}" ${pinned.includes(b)?'checked':''}>
                <label class="form-check-label" for="pin_${b}">${b}</label></div>`;
            });
        }
    }
    function savePins() {
        const checked = Array.from(document.querySelectorAll('.chk-pin:checked')).map(c => c.value);
        localStorage.setItem('pinnedBanks', JSON.stringify(checked));
        document.getElementById('pinSettingsArea').style.display = 'none';
        refreshDropdowns();
    }
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>